<html>
<head>
    <title>Videowall</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script type="text/javascript" 
        src="http://localhost:8000/faye/client.js">
    </script>
    <script type="text/javascript">
        var client = new Faye.Client('http://localhost:8000/faye', { retry: 5 });
        var duration = 1;
        var timer;

        client.subscribe('/publications', publicationsHandler);

        client.bind('transport:down', function() {
            console.log("Disconnected");
            timer = setTimeout(function() {
                $('#content').attr('src', './backup.html');
            }, duration * 1000);
        });

        client.bind('transport:up', function() {
            console.log("Connected");
            clearTimeout(timer);
            client.publish('/whatson', {text: "Teh fuck is on?"});
        });

        function publicationsHandler(item) {
            console.log("[" + (new Date()) + "] Item: " + JSON.stringify(item));
            duration = item.duration;
            $('#content').attr('src', item.url);
        }
    </script>
</head>
<body style="overflow:hidden;padding: 0px; margin: 0px">
    <iframe
        style="width: 100%; height: 100%; border: 0px; padding: 0px;margin: 0px"
        id="content"
        src="./backup.html" >
    </iframe>
</body>
</html>